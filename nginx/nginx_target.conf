# nginx_TCP_Proxy.conf
# (이 내용을 nginx_target.conf에 복사)

# Nginx 실행 유저 및 워커 설정
worker_processes  auto;
pid /var/run/nginx.pid;

events {
    worker_connections  1024;
}

# --- 1. TCP 프록시 (SSL Passthrough) ---
stream {
    server {
        listen 443;
        proxy_pass [공유기_공인_IP]:[포트];
        proxy_protocol on; # 원본 IP 보존
    }
}

# --- 2. HTTP (Certbot 갱신 및 443 리디렉션) ---
http {
    # Certbot을 위한 80 포트 설정
    server {
        listen 80;
        server_name {YOUR_DOMAIN_HERE};

        # Certbot 인증 경로
        location /.well-known/acme-challenge/ {
            root /var/www/certbot;
        }

        # 나머지 80 포트 요청은 443(HTTPS)로 리디렉션
        location / {
            return 301 https://$host$request_uri;
        }
    }
}